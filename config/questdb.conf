# QuestDB Configuration File
# High-Performance Configuration for Pi5 (16GB RAM) + 7600X Architecture
# Optimized for 3-6 GB/hour sustained telemetry ingestion

# =============================================================================
# HTTP Interface (Web Console + HTTP Ingress)
# =============================================================================
http.enabled=true
http.bind.to=0.0.0.0:9000
# Increased connection pools for high concurrency
http.connection.pool.initial.capacity=16
http.connection.string.pool.capacity=128
http.multipart.header.buffer.size=1024
http.multipart.idle.spin.count=10000
http.request.header.buffer.size=65536
# http.response.header.buffer.size=65536
http.send.buffer.size=2097152
http.static.index.file.name=index.html

# =============================================================================
# PostgreSQL Wire Protocol (Dashboard & Grafana READ Operations)
# =============================================================================
pg.enabled=true
pg.net.bind.to=0.0.0.0:8812
# High connection limits for concurrent dashboard users
pg.net.connection.limit=32
pg.character.store.capacity=4096
pg.connection.pool.capacity=32
pg.password=quest
pg.user=admin
# Query optimization
pg.select.cache.enabled=true
pg.select.cache.block.count=128
pg.insert.cache.enabled=true
pg.insert.cache.row.count=256000

# =============================================================================
# InfluxDB Line Protocol over TCP (High-Throughput Telemetry Ingestion)
# =============================================================================
line.tcp.enabled=true
line.tcp.net.bind.to=0.0.0.0:9009
# Aggressive connection pooling for 7600X ingress
line.tcp.connection.pool.capacity=32
line.tcp.net.connection.hint=true
line.tcp.net.connection.limit=128
line.tcp.net.connection.queue.timeout=300000
# Large buffers for high-throughput ingestion (512KB for dedup-enabled batches)
line.tcp.recv.buffer.size=524288

# =============================================================================
# InfluxDB Line Protocol over HTTP (Alternative Ingress)
# =============================================================================
line.http.enabled=true

# =============================================================================
# Performance & Memory Optimization (Pi5 16GB Tuning)
# =============================================================================

# Cairo Engine (High-Performance Time-Series Storage)
cairo.commit.lag=60000
cairo.max.uncommitted.rows=25000
# cairo.commit.mode=nosync
cairo.wal.enabled.default=true     

# Memory Management (Optimized for 16GB system)
cairo.sql.copy.root=/tmp/questdb         
cairo.sql.backup.root=/var/lib/questdb/backup
cairo.sql.backup.mkdir.mode=764

# Shared Worker Pool (Utilize Pi5's 4 cores effectively)
shared.worker.count=4                    
shared.worker.affinity=1,2,3,4          
shared.worker.yield.threshold=10


# =============================================================================
# Query Performance Optimization
# =============================================================================

# SQL Query Engine
cairo.sql.copy.buffer.size=1048576       

cairo.sql.groupby.map.capacity=256
cairo.sql.groupby.pool.capacity=256

# Join and Aggregation Optimization
cairo.sql.join.context.pool.capacity=16
cairo.sql.max.negative.limit=10000
cairo.sql.sort.key.page.size=2097152     
cairo.sql.sort.key.max.pages=128
cairo.sql.sort.light.value.page.size=524288  
cairo.sql.sort.light.value.max.pages=512

# =============================================================================
# I/O Optimization (PCIe SSD on Pi5)
# =============================================================================

# Page Cache Settings
cairo.writer.data.append.page.size=16777216    
cairo.writer.misc.append.page.size=4194304     

# =============================================================================
# Network & Protocol Optimization
# =============================================================================

# Circuit Breaker Pattern
net.test.connection.buffer.size=128
circuit.breaker.throttle=100

# Metrics and Monitoring
metrics.enabled=true

# =============================================================================
# Security Settings
# =============================================================================
# Note: In production, consider enabling authentication
# http.security.readonly=false
# pg.readonly.user.enabled=true